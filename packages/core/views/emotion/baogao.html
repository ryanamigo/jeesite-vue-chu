package com.jeesite.modules.subject.web;

/**
 * @program: PsychologyHealthy
 * @description: pdf导出
 * @author: ztf
 * @create: 2024-05-18 09:27
 **/
import java.text.DecimalFormat;
import java.util.Base64;
import java.io.ByteArrayOutputStream;

import com.itextpdf.io.image.ImageDataFactory;
import com.itextpdf.kernel.colors.DeviceRgb;
import com.itextpdf.kernel.font.PdfFont;
import com.itextpdf.kernel.font.PdfFontFactory;
import com.itextpdf.kernel.pdf.PdfDocument;
import com.itextpdf.kernel.pdf.canvas.PdfCanvas;
import com.itextpdf.layout.property.TextAlignment;
import com.itextpdf.text.*;
import com.itextpdf.text.Font;
import com.itextpdf.text.Image;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.pdf.*;
import com.jeesite.modules.emotion.dao.EmotionResultDao;
import com.jeesite.modules.emotion.entity.EmotionParam;
import com.jeesite.modules.emotion.entity.EmotionResult;
import com.jeesite.modules.emotion.service.EmotionParamService;
import com.jeesite.modules.emotion.service.EmotionResultService;
import com.jeesite.modules.subject.dao.SubjectInformationDao;
import com.jeesite.modules.subject.entity.*;
import com.jeesite.modules.subject.service.SubjectInformationService;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.imageio.ImageIO;
import javax.servlet.http.HttpServletResponse;
import java.awt.*;
import java.awt.geom.Path2D;
import java.awt.image.BufferedImage;
import java.io.*;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.List;

@Controller
@RequestMapping(value = "${adminPath}/subject/pdfExport")
public class PdfExporter {
    @Autowired
    private EmotionResultService emotionResultService;
    @Autowired
    private SubjectInformationService subjectInformationService;
    @Autowired
    private SubjectInformationDao subjectInformationDao;
    @Autowired
    private EmotionParamService emotionParamService;
    @Autowired
    private EmotionResultDao emotionResultDao;
    @Value("${projectFile.path}")
    private String projectFilePath;

    /**
     * //     * @param videoId java.lang.String:
     * //     * @param pidCard java.lang.String:
     *
     * @Description: 批量导出pdf文件
     * @return: org.springframework.http.ResponseEntity<?>
     * @Author: 鄢文杰
     * @Update: ztf
     * @Date: 2024/5/25 16:39
     */
    @RequestMapping(value = "BatchExport")
    @ResponseBody
    public void BatchExport(List<String> videoIds, HttpServletResponse response) throws IOException, DocumentException {
        for (String videoId : videoIds) {
// 调用 getPdfFile 方法处理每个 videoId
            exportPdfFile(videoId,"null");
        }
    }

    /**
     * //     * @param videoId java.lang.String:
     *
     * @param pidCard java.lang.String:
     * @Description: 导出pdf文件
     * @return: org.springframework.http.ResponseEntity<?>
     * @Author: 鄢文杰
     * @Update: ztf
     * @Date: 2024/5/25 16:39
     */
    @RequestMapping(value = "exportPdfFile")
    @ResponseBody
    public String exportPdfFile(@RequestParam(value = "videoId", required = false) String videoId,
                                @RequestParam(value = "pidCard", required = false) String pidCard
                              ) {
        try {
            // 判断前端传递的是哪个参数，优先使用 videoId
            if (videoId != null && !videoId.isEmpty()) {
                // 使用 videoId 导出PDF文件
                EmotionSubject emotionSubject = emotionResultDao.findDataOfPDF(videoId);
                getPdfFileByPidCard(emotionSubject);
            } else if
            (pidCard != null && !pidCard.isEmpty()) {
                List<String> id = emotionResultDao.findVideoIdByPidCard(pidCard);
                // 使用 pidCard 导出PDF文件
                for (String VideoId : id) {
                    EmotionSubject emotionSubject = emotionResultDao.findDataOfPDF(VideoId);
                    getPdfFileByPidCard(emotionSubject);
                }
            } else {
                // 如果两个参数都没有传递，抛出异常
                throw new IllegalArgumentException("必须提供 videoId 或 pidCard 参数。");
            }
            return "PDF 文件生成成功";
        } catch (Exception e) {
            e.printStackTrace();
            return "PDF 文件生成失败";
        }
    }
//    @RequestMapping(value = "exportPdfFile")
//    @ResponseBody
//    public String exportPdfFile(@RequestParam(value = "pidCard", required = false) String pidCard,
//                                HttpServletResponse response) {
//        try {
//            List<String> videoId = emotionResultDao.findVideoIdByPidCard(pidCard);
//
//            return "PDF 文件生成成功";
//        } catch (Exception e) {
//            e.printStackTrace();
//            return "PDF 文件生成失败";
//        }
//    }

    @RequestMapping(value = "getSuggestionText")
    @ResponseBody
    public  String getSuggestionText(int result) {
        String suggestion = "";
//        String classPath = obtainAbsolutePath(PdfExporter.class);
        String fontPath ="D:\\481\\AI_Emotion\\confg\\txt文档\\suggestion.txt";
        // 读取 suggestion.txt 文件
        try (BufferedReader br = new BufferedReader(new FileReader(fontPath))) {
            String line;
            while ((line = br.readLine()) != null) {
                String[] parts = line.split("、");
                if (parts.length == 2) {
                    int key = Integer.parseInt(parts[0].trim());
                    if (key == result) {
                        suggestion = parts[1].trim();
                        break; // 找到匹配项后跳出循环
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

        return suggestion;
    }
//跟踪
    @RequestMapping(value = "getSuggestionText2")
    @ResponseBody
    public  String getSuggestionText2(int result) {
        String suggestion = "";
//        String classPath = obtainAbsolutePath(PdfExporter.class);
        String fontPath ="D:\\481\\AI_Emotion\\confg\\txt文档\\suggestion2.txt";
        // 读取 suggestion.txt 文件
        try (BufferedReader br = new BufferedReader(new FileReader(fontPath))) {
            String line;
            while ((line = br.readLine()) != null) {
                String[] parts = line.split("、");
                if (parts.length == 2) {
                    int key = Integer.parseInt(parts[0].trim());
                    if (key == result) {
                        suggestion = parts[1].trim();
                        break; // 找到匹配项后跳出循环
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

        return suggestion;
    }
//综合两者
    @RequestMapping(value = "getSuggestionText3")
    @ResponseBody
    public  String getSuggestionText3(int result) {
        String suggestion = "";
//        String classPath = obtainAbsolutePath(PdfExporter.class);
        String fontPath ="D:\\481\\AI_Emotion\\confg\\txt文档\\suggestion3.txt";
        // 读取 suggestion.txt 文件
        try (BufferedReader br = new BufferedReader(new FileReader(fontPath))) {
            String line;
            while ((line = br.readLine()) != null) {
                String[] parts = line.split("、");
                if (parts.length == 2) {
                    int key = Integer.parseInt(parts[0].trim());
                    if (key == result) {
                        suggestion = parts[1].trim();
                        break; // 找到匹配项后跳出循环
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

        return suggestion;
    }

    /**
     * @param videoId java.lang.String:
     * @Description: 获取pdf文件
     * @return: void
     * @Author: 鄢文杰。ztf
     * @Update:
     * @Date: 2024/5/18 10:04
     */
    @RequestMapping(value = "getPdfFile")
    @ResponseBody
    public void getPdfFile(String videoId) throws IOException, DocumentException {
        Document document = new Document();

    }


    private void getPdfFileByPidCard(EmotionSubject emotionSubject) {
        Document document = new Document();
        try {
            // 设置导出文件路径

            String baseDir = "D:\\AI_Emotion\\Data\\个人PDF报告";
            File baseDirectory = new File(baseDir);

            // 检查基础目录是否存在
            if (!baseDirectory.exists()) {
                baseDirectory.mkdirs();  // 创建基础目录
            }


            Date createdAtDate = emotionSubject.getCreatedAt();
            String createdAt = new SimpleDateFormat("yyyy-MM-dd").format(createdAtDate);

            String folderName = emotionSubject.getTestNumberName() + emotionSubject.getPname();
            File newDir = new File(baseDir, folderName);
            if (!newDir.exists()) {
                newDir.mkdirs();  // 创建新文件夹
            }

            // 设置导出 PDF 文件的路径
            String pdfFilePath = newDir.getAbsolutePath() + "/" + emotionSubject.getVideoId() + createdAt + ".pdf";

            // 创建 PDF 写入器
            PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(pdfFilePath));
            // 打开文档
            document.open();

            // 获取 PdfContentByte 用于绘制背景和文本
            PdfContentByte canvas = writer.getDirectContent();

            // 加载封面背景图像
            String classPath = obtainAbsolutePath(PdfExporter.class);
            String fontPath3 = "D:\\481\\AI_Emotion\\confg\\aa\\fm.png";
//            String coverImagePath = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/fm.png";
            Image coverImage = Image.getInstance(fontPath3);

            // 手动调整封面图像的宽度和高度，使其宽度大于页面宽度
            float pageWidth = document.getPageSize().getWidth();
            float pageHeight = document.getPageSize().getHeight();

            float newWidth = pageWidth * 1f;  // 背景宽度为页面宽度的1倍
            float newHeight = (newWidth / coverImage.getWidth()) * coverImage.getHeight();  // 保持图像的纵横比

            coverImage.scaleAbsolute(newWidth, newHeight); // 强制设置新的宽度和高度
            coverImage.setAbsolutePosition((pageWidth - newWidth) / 2, 0); // 将图像水平居中，并从顶部开始

            // 在添加文字之前，先添加背景图像
            canvas.addImage(coverImage);

            // 加载字体
            String fontPath = "D:\\481\\AI_Emotion\\confg\\aa\\Song.ttf";
            String fontPath2 =  "D:\\481\\AI_Emotion\\confg\\aa\\cu.ttf";
//            String fontPath = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/Song.ttf"; // 绝对路径
//            String fontPath2 = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/cu.ttf"; // 绝对路径
            BaseFont baseFont2 = BaseFont.createFont(fontPath2, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);  // 使用 Identity-H 作为编码格式，支持中文

            BaseFont baseFont = BaseFont.createFont(fontPath, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);  // 使用 Identity-H 作为编码格式，支持中文
            Font titleFont = new Font(baseFont, 24, Font.BOLD); // 使用加载的字体设置标题样式
            Font infoFont = new Font(baseFont, 12, Font.NORMAL); // 设置字体为自定义字体

            // 设置封面内容及位置
            float x = 100; // X 位置
            float y = 550; // Y 位置 (调整开始位置使其更低)

            canvas.beginText();
//            canvas.setFontAndSize(baseFont, 48);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("心理状态评估报告");

            // 副标题
//            canvas.setFontAndSize(baseFont, 15);
//            y -= 25; // 向下移动 (增加此值，使字体向下调整)
//            canvas.setTextMatrix(175, y);
//            canvas.showText("Psychological Assessment Report");

            // 添加人员信息
            canvas.setFontAndSize(baseFont, 24);
            y -= 100;
            x += 25; // 向下移动 (增加此值，使字体向下调整)
            canvas.setTextMatrix(125, y);
            canvas.showText(emotionSubject.getPname());

            canvas.setFontAndSize(baseFont, 24);
            canvas.setTextMatrix(325, y);
            canvas.showText("任务批次："+emotionSubject.getTestNumberName());


            canvas.setFontAndSize(baseFont, 18);
           x=125; y -= 50; // 向下移动
            canvas.setTextMatrix(x, y);
            canvas.showText("年龄: "+emotionSubject.getAge());

            y -= 50; // 向右移动
            canvas.setTextMatrix(x, y);
            canvas.showText("性别: "+emotionSubject.getPgender());

            y -= 50;
             // 向左调整 X 位置
            canvas.setTextMatrix(x, y);
            canvas.showText("部门: "+emotionSubject.getPpositionName());
            SimpleDateFormat dateFormat1 = new SimpleDateFormat("yyyy.MM.dd");
            // 向右移动
            y -= 50;
            canvas.setTextMatrix(x, y);
            canvas.showText("测试时间: "+dateFormat1.format(emotionSubject.getCreatedAt()));

            canvas.endText(); // 结束文本绘制

            // 创建新的一页
            document.newPage();

            // 加载新的背景图像
            String newImagePath = "D:\\481\\AI_Emotion\\confg\\aa\\bj.png";
//            String newImagePath = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/bj.png";
            Image newBackgroundImage = Image.getInstance(newImagePath);

            // 重新设置新背景图像的大小和位置
            newWidth = pageWidth * 1f;
            newHeight = (newWidth / newBackgroundImage.getWidth()) * newBackgroundImage.getHeight(); // 保持图像纵横比

            newBackgroundImage.scaleAbsolute(newWidth, newHeight); // 强制设置新的宽度和高度
            newBackgroundImage.setAbsolutePosition((pageWidth - newWidth) / 2, 0); // 将图像水平居中

            // 在新的一页上添加背景图像
            canvas.addImage(newBackgroundImage);
            // 在新的一页上继续添加报告内容
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 200);  // 蓝色的 RGB 值 (0, 0, 255)

            canvas.setFontAndSize(baseFont2, 24);
            x = 50;
            y = pageHeight - 80; // 重设 Y 坐标为新的页面顶部
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 0)
            // 继续添加报告的内容，例如：
            canvas.setTextMatrix(x, y);
            canvas.showText("一、整体评估");
            canvas.endText(); // 结束文本绘制

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 255)
            canvas.setFontAndSize(baseFont, 8);
            y += 10;
            x += 150; // 向下移动
            canvas.setTextMatrix(x, y);
            canvas.showText("须知:本报告数据仅供参考，不作为临床诊断或治疗依据。旨在帮助您更好地了解自身心理状态，不代表专业");

            y -= 20;
            canvas.setTextMatrix(x, y);
            canvas.showText("心理健康评估或建议。如果您感到持续困扰或需要进一步的帮助，请务必咨询专业心理咨询师或医疗健康机构。");


            canvas.setFontAndSize(baseFont2, 24);
            y -= 55;
            x = 30;
            canvas.setTextMatrix(x, y);
            canvas.showText("评估概述");
            canvas.endText(); // 结束文本绘制

            // 设置灰色线条颜色 (RGB 值)
            canvas.setRGBColorStroke(169, 169, 169);  // 灰色的 RGB 值 (169, 169, 169)

            // 绘制一条横线，起始点和结束点的坐标
            float lineStartY = y - 10;  // 设置线条的位置，比 "评估概述" 向下 10 单位
            float lineEndY = lineStartY;  // 线条结束的 Y 坐标

            // 绘制从 (x, lineStartY) 到 (x + 200, lineEndY) 的线条
            canvas.moveTo(x, lineStartY);  // 起始点
            canvas.lineTo(x + 200, lineEndY);  // 结束点
            canvas.stroke();  // 绘制线条
            canvas.beginText();
            canvas.setFontAndSize(baseFont, 8);
            x = 30;
            y -= 30;
            canvas.setTextMatrix(x, y);
            canvas.showText("    心理健康值是对个体心理状态的综合评估，反映情感、认知和行为的健康状况。");

            x = 30;
            y -= 15;
            canvas.setTextMatrix(x, y);
            canvas.showText("    良好的心理健康值意味着个体能有效应对压力、维持积极心态和稳定情感。较低");

            x = 30;
            y -= 15;
            canvas.setTextMatrix(x, y);
            canvas.showText("    的心理健康值可能表示存在焦虑、抑郁等心理困扰，评估心理健康值有助于识别");
            x = 30;
            y -= 15;
            canvas.setTextMatrix(x, y);
            canvas.showText("    别问题并提供干预建议，促进心理健康提升。");

            canvas.setFontAndSize(baseFont2, 24);
            y = 580;
            x = 30;
            canvas.setTextMatrix(x, y);
            canvas.showText("评估画面");
            canvas.endText(); // 结束文本绘制

            canvas.setRGBColorStroke(169, 169, 169);  // 灰色的 RGB 值 (169, 169, 169)

            // 绘制一条横线，起始点和结束点的坐标
            float lineStartY2 = y - 10;  // 设置线条的位置，比 "评估概述" 向下 10 单位
            float lineEndY2 = lineStartY2;  // 线条结束的 Y 坐标

            // 绘制从 (x, lineStartY) 到 (x + 200, lineEndY) 的线条
            canvas.moveTo(x, lineStartY2);  // 起始点
            canvas.lineTo(x + 150, lineEndY2);  // 结束点
            canvas.stroke();  // 绘制线条

            // 图片存储路径和PDF保存路径
            String folderPath = "D:\\AI_Emotion\\Data\\pictrue\\" + emotionSubject.getTestNumber() + emotionSubject.getPname() +emotionSubject.getPidcard();
// 插入图片的文件路径
            String[] imagePaths = {
                    folderPath + "/" + emotionSubject.getPname() + "_" + emotionSubject.getPidcard() + "0.png",
                    folderPath + "/" + emotionSubject.getPname() + "_" + emotionSubject.getPidcard() + "1.png",
                    folderPath + "/" + emotionSubject.getPname() + "_" + emotionSubject.getPidcard()  + "2.png",
                    folderPath + "/" +emotionSubject.getPname() + "_" + emotionSubject.getPidcard()  + "3.png"
            };
            System.out.println("图片路径: " + imagePaths);
            // 遍历图片路径并插入到PDF中
            // 设置图片插入的起始位置
             x = 0;
             y = 480; // 图片插入的Y轴位置，依情况调整

            // 遍历图片路径并插入图片
            for (String imagePath : imagePaths) {
                // 创建File对象来检查文件是否存在
                File imageFile = new File(imagePath);

                // 如果文件存在，则插入图片，否则跳过
                if (imageFile.exists()) {
                    // 加载图片
                    Image img = Image.getInstance(imagePath);

                    // 设置图片位置和大小
                    img.setAbsolutePosition(x, y); // 设置图片左下角位置
                    img.scaleToFit(120, 120); // 设置图片大小，最大150x150像素

                    // 将图片插入到文档中



                    canvas.addImage(img);

                    // 调整Y位置，避免图片重叠
                    x += 160; // 每次图片插入后，Y轴位置降低160
                } else {
                    // 输出日志或提示信息
                    System.out.println("图片未找到，跳过插入: " + imagePath);
                }
            }








            canvas.beginText();
//            canvas.setFontAndSize(baseFont2, 24);
            y -= 60;
            x = 30;
            canvas.setTextMatrix(x, y);
            canvas.showText("评估结果");
            canvas.endText(); // 结束文本绘制
            // 设置灰色线条颜色 (RGB 值)
            canvas.setRGBColorStroke(169, 169, 169);  // 灰色的 RGB 值 (169, 169, 169)

            // 绘制一条横线，起始点和结束点的坐标
            lineStartY2 = y - 10;  // 设置线条的位置，比 "评估概述" 向下 10 单位
            lineEndY2 = lineStartY2;  // 线条结束的 Y 坐标

            // 绘制从 (x, lineStartY) 到 (x + 200, lineEndY) 的线条
            canvas.moveTo(x, lineStartY2);  // 起始点
            canvas.lineTo(x + 150, lineEndY2);  // 结束点
            canvas.stroke();  // 绘制线条

//            canvas.beginText();
//            canvas.setFontAndSize(baseFont2, 18);
//            y -= 35;
//            x = 60;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("本次评估总体水平");
//            canvas.endText(); // 结束文本绘制


//            // 创建一个 PdfGState 对象设置透明度
//            PdfGState gState = new PdfGState();
//            gState.setFillOpacity(0.2f);  // 设置填充的透明度 (0.0: 完全透明, 1.0: 完全不透明)
//
//            // 将透明度设置到 canvas
//            canvas.setGState(gState);
//            // 设置矩形的填充颜色为红色
//            canvas.setRGBColorFill(180, 0, 0);  // 红色填充
//            canvas.setRGBColorStroke(255, 0, 0);  // 红色边框
//            // 绘制关注矩形框
//            x = 60;
//            y -= 90;
//            float width = 50;
//            float height = 50;
//            canvas.rectangle(x, y, width, height);  // 定义矩形框
//            canvas.fillStroke();  // 填充并绘制边框
//
//            //绘制一般矩形框
//            // 创建一个 PdfGState 对象设置透明度
//            PdfGState gState2 = new PdfGState();
//            gState2.setFillOpacity(0.2f);  // 设置填充的透明度 (0.0: 完全透明, 1.0: 完全不透明)
//
//            // 设置矩形的填充颜色为红色
//            canvas.setRGBColorFill(255, 165, 0);  // 红色填充
//            canvas.setRGBColorStroke(255, 165, 0);  // 红色边框
//            x = 111;
//            float width2 = 80;
//            float height2 = 50;
//            canvas.rectangle(x, y, width2, height2);  // 定义矩形框
//            canvas.fillStroke();  // 填充并绘制边框
//            //正常边框
//            // 创建一个 PdfGState 对象设置透明度
//            PdfGState gState3 = new PdfGState();
//            gState3.setFillOpacity(0.2f);  // 设置填充的透明度 (0.0: 完全透明, 1.0: 完全不透明)
//
//            // 设置矩形的填充颜色为蓝色
//            canvas.setRGBColorFill(0, 0, 200);  // 红色填充
//            canvas.setRGBColorStroke(0, 0, 200);  // 红色边框
//            x = 191;
//            y = 522;
//            float width3 = 320;
//            float height3 = 50;
//
//            // 计算新的顶点位置，形成五边形
//            float newX = x + width3 * 1.1f;  // 将新顶点位于矩形右侧，偏右
//            float newY = y - height3 / 2;   // 顶点的 Y 坐标居中于矩形
//            // 绘制矩形的四个顶点
//            canvas.moveTo(x, y);  // 左上角
//            canvas.lineTo(x, y - height3);  // 左下角
//            canvas.lineTo(x + width3, y - height3);  // 右下角
//            canvas.lineTo(newX, newY);  // 新顶点
//            canvas.lineTo(x + width3, y);  // 右上角
//            // 完成五边形，回到起始点
//            canvas.closePath();  // 结束路径并闭合
//            // 填充并绘制边框
//            canvas.fillStroke();  // 填充并绘制边框
//
//            PdfGState gState4 = new PdfGState();
//            gState4.setFillOpacity(1.0f);  // 设置填充的透明度 (0.0: 完全透明, 1.0: 完全不透明)
//            canvas.setGState(gState4);
//            // 设置填充颜色为红色
//            canvas.setRGBColorFill(255, 0, 0);  // 红色填充
//            // 绘制圆形：圆心坐标为 (x, y)，半径为 r
//            float x1 = 400;  // 圆心 X 坐标
//            float y1 = 522;  // 圆心 Y 坐标
//            float r = 16;   // 圆的半径
//
//            // 绘制圆形路径
//            canvas.circle(x1, y1, r); // 参数分别为 圆心 (x, y) 和 半径 r
//            // 填充圆形
//            canvas.fill();  // 填充圆形
//
//            canvas.setFontAndSize(baseFont, 8);
//            x = 350;
//            y = 530;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("您的位置");
//
//            canvas.setFontAndSize(baseFont, 10);
//            x = 100;
//            y = 462;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("关注");
//
//            canvas.setFontAndSize(baseFont, 10);
//            x = 180;
//            y = 462;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("一般");
//
//            canvas.setFontAndSize(baseFont, 10);
//            x = 280;
//            y = 462;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("正常");

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0);
            canvas.setFontAndSize(baseFont2, 18);
            y = 375;
            x = 40;
            canvas.setTextMatrix(x, y);
            canvas.showText("本任务批次评估情况");
            x+=160;
            canvas.setRGBColorFill(173, 216, 230); // 浅蓝色
            canvas.setTextMatrix(x, y);
            canvas.showText("(平均值          )");
            x+=65;
            canvas.setRGBColorFill(0, 0, 230); // 浅蓝色
            canvas.setTextMatrix(x, y);
            canvas.showText("评估值");
            canvas.endText(); // 结束文本绘制


            //分位图
            // 设置初始位置
            x = 45;
            y = 300;
            float barWidth = 230; // 分位图宽度
            float barHeight = 25; // 分位图高度
            float segmentWidth = barWidth / 10; // 每段的宽度
            Min min = new Min();
            Max max = new Max();
            Avg avg = new Avg();
            min = subjectInformationDao.findMinData(emotionSubject.getPidcard());
            max = subjectInformationDao.findMaxData(emotionSubject.getPidcard());
            avg = subjectInformationDao.findAvgData(emotionSubject.getPidcard());
            // 绘制单个分位图的方法
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "紧张", 1, new BaseColor(0, 102, 204), baseFont,min.getAggressionMMin(),max.getAggressionMMax(), avg.getAggressionAvg(), emotionSubject.getAggressionM());

            // 绘制其他分位图（示例）
            y -= 65; // 移动到下一个分位图
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "焦虑", 3, new BaseColor(0, 102, 204), baseFont,min.getTensionMMin(),max.getTensionMMax(),avg.getTensionAvg(),emotionSubject.getTensionM());

            y -= 65;
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "能量", 7, new BaseColor(0, 102, 204), baseFont,min.getEnergyMin(),max.getEnergyMax(),avg.getEnergyAvg(),emotionSubject.getEnergyM());

            y -= 65;
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "压抑", 7, new BaseColor(0, 102, 204), baseFont,min.getDepressionMin(),max.getDepressionMaxn(),avg.getDepressionAvg(),emotionSubject.getDepressionM());
            x = 330;
            y = 300;
            // 绘制单个分位图的方法
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "压力", 1, new BaseColor(0, 102, 204), baseFont,min.getStressMMin(),max.getStressMMax(), avg.getStressAvg(),emotionSubject.getStressM());

            // 绘制其他分位图（示例）
            y -= 65; // 移动到下一个分位图
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "疲劳", 3, new BaseColor(0, 102, 204), baseFont,min.getFatigueMin(),max.getFatigueMax(), avg.getFatigueAvg(), emotionSubject.getFatigue());

            y -= 65;
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "平衡", 7, new BaseColor(0, 102, 204), baseFont,min.getCharmMin(),max.getCharmMax(),avg.getCharmAvg(),emotionSubject.getCharmM());

            y -= 65;
            drawPercentileChart(canvas, x, y, barWidth, barHeight, "稳定", 7, new BaseColor(0, 102, 204), baseFont,min.getRegulationMin(),max.getRegulationMax(), avg.getRegulationAvg(), emotionSubject.getRegulationM());
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255);  // 白色 (RGB: 255, 255, 255)
            canvas.setFontAndSize(baseFont, 10);
            canvas.setTextMatrix(25, 20);
            canvas.showText("心 理 状 态 评 估 报 告");
            canvas.setTextMatrix(525, 20);
            canvas.showText("1");
            canvas.endText();

            //第三页
            // 创建新的一页
            document.newPage();
            // 重新设置新背景图像的大小和位置
            newWidth = pageWidth * 1f;
            newHeight = (newWidth / newBackgroundImage.getWidth()) * newBackgroundImage.getHeight(); // 保持图像纵横比

            newBackgroundImage.scaleAbsolute(newWidth, newHeight); // 强制设置新的宽度和高度
            newBackgroundImage.setAbsolutePosition((pageWidth - newWidth) / 2, 0); // 将图像水平居中

            // 在新的一页上添加背景图像
            canvas.addImage(newBackgroundImage);
            // 在新的一页上继续添加报告内容
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 200);  // 蓝色的 RGB 值 (0, 0, 255)

            canvas.setFontAndSize(baseFont2, 24);
            x = 50;
            y = pageHeight - 80; // 重设 Y 坐标为新的页面顶部

            // 继续添加报告的内容，例如：
            canvas.setTextMatrix(x, y);
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 0)
            canvas.showText("二、综合评估");
            canvas.endText(); // 结束文本绘制

            Image radarImage = generateRadarImage(600, 600,emotionSubject);
            radarImage.scaleToFit(150, 150); // 设置图像的最大尺寸
            radarImage.setAbsolutePosition(35, 535); // 设置图像在页面上的位置

            PdfGState gs = new PdfGState();
            gs.setStrokeOpacity(0.2f); // 设置线框的透明度 (0.0: 完全透明, 1.0: 完全不透明)

            // 应用透明度
            canvas.setGState(gs);

            // 绘制淡蓝色线框
            canvas.setRGBColorStroke(173, 216, 250); // 设置线框为淡蓝色
            canvas.setLineWidth(1); // 设置线框宽度
            float framePadding = 10; // 设置线框与图片的间距
            canvas.rectangle(
                    30,                      // 左边框位置
                    525,                      // 下边框位置
                    140 + framePadding * 2,                // 矩形宽度
                    150 + framePadding * 2                 // 矩形高度
            );
            canvas.stroke(); // 绘制线框

            // 将雷达图添加到 PDF
            canvas.addImage(radarImage);

            PdfGState gs1 = new PdfGState();
            gs1.setStrokeOpacity(0.4f); // 设置线框的透明度 (0.0: 完全透明, 1.0: 完全不透明)

            // 应用透明度
            canvas.setGState(gs1);

            // 设置标题框的参数
            x = 25; // 左上角 x 坐标
            y = 725; // 左上角 y 坐标
            float width = 170; // 标题框宽度
            float height = 20; // 标题框高度
            float radius = 15; // 圆角的半径
            canvas.setRGBColorFill(0, 102, 204);
            // 绘制圆角矩形的路径
            canvas.moveTo(x + radius, y); // 从左上角的圆角开始
            canvas.lineTo(x + width - radius, y); // 上边
            canvas.curveTo(x + width, y, x + width, y - radius, x + width, y - radius); // 右上圆角
            canvas.lineTo(x + width, y - height + radius); // 右边
            canvas.curveTo(x + width, y - height, x + width - radius, y - height, x + width - radius, y - height); // 右下圆角
            canvas.lineTo(x + radius, y - height); // 下边
            canvas.curveTo(x, y - height, x, y - height + radius, x, y - height + radius); // 左下圆角
            canvas.lineTo(x, y - radius); // 左边
            canvas.curveTo(x, y, x + radius, y, x + radius, y); // 左上圆角

            canvas.closePathFillStroke(); // 填充并绘制边框
            // 在标题框内添加白色文字
            String title = "心理情绪表"; // 标题内容
            canvas.beginText();
            canvas.setFontAndSize(baseFont2, 9); // 设置字体大小
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色为白色
            canvas.showTextAligned(Element.ALIGN_CENTER, title, x + width / 2, y - height / 2 - 3, 0); // 居中显示标题
            canvas.endText();

            gs.setStrokeOpacity(0.2f); // 设置线框的透明度 (0.0: 完全透明, 1.0: 完全不透明)

            // 应用透明度
            canvas.setGState(gs);

            // 绘制淡蓝色线框
            canvas.setRGBColorStroke(173, 216, 250); // 设置线框为淡蓝色
            canvas.setLineWidth(1); // 设置线框宽度
            canvas.rectangle(
                    230,                      // 左边框位置
                    525,                      // 下边框位置
                    310,                // 矩形宽度
                    150 + framePadding * 2                 // 矩形高度
            );
            canvas.stroke(); // 绘制线框

            // 设置标题框的参数
            x = 225; // 左上角 x 坐标
            y = 725; // 左上角 y 坐标
            width = 320; // 标题框宽度
            height = 20; // 标题框高度
            radius = 15; // 圆角的半径
            canvas.setRGBColorFill(0, 102, 204);
            // 绘制圆角矩形的路径
            canvas.moveTo(x + radius, y); // 从左上角的圆角开始
            canvas.lineTo(x + width - radius, y); // 上边
            canvas.curveTo(x + width, y, x + width, y - radius, x + width, y - radius); // 右上圆角
            canvas.lineTo(x + width, y - height + radius); // 右边
            canvas.curveTo(x + width, y - height, x + width - radius, y - height, x + width - radius, y - height); // 右下圆角
            canvas.lineTo(x + radius, y - height); // 下边
            canvas.curveTo(x, y - height, x, y - height + radius, x, y - height + radius); // 左下圆角
            canvas.lineTo(x, y - radius); // 左边
            canvas.curveTo(x, y, x + radius, y, x + radius, y); // 左上圆角

            canvas.closePathFillStroke(); // 填充并绘制边框
            // 在标题框内添加白色文字
            title = "情绪跟踪指数"; // 标题内容
            canvas.beginText();
            canvas.setFontAndSize(baseFont2, 9); // 设置字体大小
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色为白色
            canvas.showTextAligned(Element.ALIGN_CENTER, title, x + width / 2, y - height / 2 - 3, 0); // 居中显示标题
            canvas.endText();


            gs1.setStrokeOpacity(0.5f); // 设置线框的透明度 (0.0: 完全透明, 1.0: 完全不透明)
            // 应用透明度
            canvas.setGState(gs1);
            // 设置图表的起始坐标和尺寸
            float xStart = 245; // 横坐标起点
            float yStart = 540; // 纵坐标起点
            width = 276;  // 图表宽度
            height = 150; // 图表高度
            canvas.setLineWidth(2); // 设置坐标轴线条宽度为2磅
            // 设置坐标轴的颜色
            canvas.setRGBColorStroke(0, 100, 200); // 黑色坐标轴

            // 绘制坐标轴
            canvas.moveTo(xStart, yStart); // X 轴起点
            canvas.lineTo(xStart + width, yStart); // X 轴终点
            canvas.moveTo(xStart, yStart); // Y 轴起点
            canvas.lineTo(xStart, yStart + height); // Y 轴终点
            canvas.stroke();


            canvas.setFontAndSize(baseFont, 4);
            // 添加 Y 轴刻度（0 到 10）

            // 获取动态的 Y 轴最小值和最大值
            Double minValue = subjectInformationDao.findTrackingMin(emotionSubject.getPidcard());
            Double maxValue = subjectInformationDao.findTrackingMax(emotionSubject.getPidcard());
// 创建 DecimalFormat 对象，设置保留一位小数
            DecimalFormat decimalFormat = new DecimalFormat("#.0");

// 如果最大值和最小值相同，只显示一个刻度
            if (minValue.equals(maxValue)) {
                y = yStart + (height / 2); // 纵坐标位置在中间

                // 格式化唯一刻度值
                String formattedValue = decimalFormat.format(minValue);

                // 显示唯一刻度
                System.out.println("唯一刻度: " + formattedValue); // 输出唯一刻度值
                canvas.beginText();
                canvas.setFontAndSize(baseFont2, 9); // 设置字体大小
                canvas.setRGBColorFill(0, 100, 200); // 设置字体颜色为蓝色
                canvas.showTextAligned(Element.ALIGN_CENTER, formattedValue, 238, y - 6, 0); // 显示唯一刻度
                canvas.endText();
            } else {
                // 计算 Y 轴刻度的数量（例如 5 个刻度）
                int yTicks = 5;
                double range = maxValue - minValue;
                double tickInterval = range / yTicks;

                // 添加 Y 轴刻度
                for (int i = 0; i <= yTicks; i++) {
                    double value = minValue + (i * tickInterval); // 每个刻度的实际值
                    y = (float) (yStart + (i * height / yTicks)); // Y 坐标位置

                    // 格式化刻度值为保留一位小数
                    String formattedValue = decimalFormat.format(value);

                    // 输出刻度值
                    System.out.println("刻度 " + i + ": " + formattedValue);

                    // 显示刻度值
                    canvas.beginText();
                    canvas.setFontAndSize(baseFont2, 9); // 设置字体大小
                    canvas.setRGBColorFill(0, 100, 200); // 设置字体颜色
                    canvas.showTextAligned(Element.ALIGN_CENTER, formattedValue, 238, y - 6, 0); // 显示刻度
                    canvas.endText();
                }
            }
            // 固定日期格式
            SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy.MM.dd");

            // 查询最近5条数据（假设DAO返回按时间排序）
            List<EmotionResult> results = emotionResultDao.findTrackingByTime(emotionSubject.getPidcard());

            // 调试：检查结果
            System.out.println("Results size: " + results.size());
            for (EmotionResult result : results) {
                System.out.println("Result date: " + result.getCreatedAt());
            }

            // 创建横坐标标签
            List<String> xLabels = new ArrayList<>();
            int maxLabels = 5;

            for (EmotionResult result : results) {
                if (result.getCreatedAt() != null) {
                    xLabels.add(dateFormat.format(result.getCreatedAt()));
                }
                // 限制最多5个
                if (xLabels.size() >= maxLabels) {
                    break;
                }
            }

            // 补全不足5个的横坐标，用 "-"
            while (xLabels.size() < maxLabels) {
                xLabels.add("-");
            }

            System.out.println("Final xLabels: " + xLabels);
            // 计算绘图的X轴位置
            int xTicks = 5; // 固定5个横坐标
             xStart = 245; // 起始X坐标，根据实际画布调整
             width = 276; // X轴总宽度，根据实际画布调整

            for (int i = 0; i < xTicks; i++) {
                 x = xStart + (i * width / (xTicks - 1)); // 坐标等距分布

                // 开始绘制
                canvas.beginText();
                canvas.setFontAndSize(baseFont2, 9); // 设置字体大小
                canvas.setRGBColorFill(0, 100, 200); // 设置字体颜色
                canvas.showTextAligned(Element.ALIGN_CENTER, xLabels.get(i), x, 530, 0); // 显示横坐标
                canvas.endText();
            }

            // 设置线条颜色为浅蓝色
            canvas.setRGBColorStroke(173, 216, 230);
            canvas.setLineWidth(1.5f); // 设置线宽

// 获取动态的 Y 轴范围
             minValue = subjectInformationDao.findTrackingMin(emotionSubject.getPidcard());
             maxValue = subjectInformationDao.findTrackingMax(emotionSubject.getPidcard());
            double range = maxValue - minValue;

// 检查是否有有效的范围
            if (range < 0) {
                System.out.println("Y 轴范围无效，无法绘制折线。");
                return;
            }

// 绘制点之间的折线
            boolean firstPoint = true;
            float prevX = 0, prevY = 0;

            for (EmotionResult result : results) {
                if (result.getCreatedAt() != null && result.getTracking() != null) {
                    // 计算横坐标
                    String dateStr = dateFormat.format(result.getCreatedAt());
                    int xIndex = xLabels.indexOf(dateStr); // 找到日期对应的索引
                    if (xIndex == -1) continue; // 如果未找到，跳过该点

                     x = xStart + (xIndex * width / (xTicks - 1)); // X 坐标

                    // 计算纵坐标
                    double value = result.getTracking();
                     y = (float) (yStart + height * (value - minValue) / range); // Y 坐标

                    // 如果是第一个点，用 moveTo
                    if (firstPoint) {
                        canvas.moveTo(x, y);
                        firstPoint = false;
                    } else {
                        // 如果不是第一个点，连接到当前点
                        canvas.lineTo(x, y);
                    }

                    // 保存当前点坐标
                    prevX = x;
                    prevY = y;
                }
            }

// 绘制线条
            canvas.stroke();

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色为蓝色（0, 0, 200）
            canvas.setFontAndSize(baseFont2, 24);
            y = 470;
            x = 30;
            canvas.setTextMatrix(x, y);
            canvas.showText("细分评估结果");
            canvas.endText(); // 结束文本绘制
            // 设置灰色线条颜色 (RGB 值)
            canvas.setRGBColorStroke(169, 169, 169);  // 灰色的 RGB 值 (169, 169, 169)
            canvas.setLineWidth(1); // 设置坐标轴线条宽度为2磅
            // 绘制一条横线，起始点和结束点的坐标
            lineStartY2 = y - 10;  // 设置线条的位置，比 "评估概述" 向下 10 单位
            lineEndY2 = lineStartY2;  // 线条结束的 Y 坐标

            // 绘制从 (x, lineStartY) 到 (x + 200, lineEndY) 的线条
            canvas.moveTo(x, lineStartY2);  // 起始点
            canvas.lineTo(x + 190, lineEndY2);  // 结束点
            canvas.stroke();  // 绘制线条

//            biaoge(canvas, 60, 490, 450, 200, baseFont, baseFont2,"1","紧张");
//            biaoge(canvas, 60, 380, 450, 200, baseFont, baseFont2,"2","压力");
//            biaoge(canvas, 60, 270, 450, 200, baseFont, baseFont2,"3","焦虑");
//            biaoge(canvas, 60, 160, 450, 200, baseFont, baseFont2,"4","疲劳");
// 浅蓝色边框矩形设置
            float rectX = 65;                // 矩形左上角的 X 坐标
            float rectY = 180;               // 矩形左上角的 Y 坐标 (根据需求调整)
            float rectWidth = 450;           // 矩形宽度
            float rectHeight = 270;          // 矩形高度

            canvas.setRGBColorStroke(173, 216, 230);  // 设置边框颜色为浅蓝色 (RGB: 173, 216, 230)
            canvas.setLineWidth(1);                   // 设置边框线条宽度
            canvas.rectangle(rectX, rectY, rectWidth, rectHeight); // 绘制矩形边框
            canvas.stroke();                          // 渲染边框

// 在矩形中绘制 8 条均分的横线
            float lineSpacing = rectHeight / 9;       // 计算每条横线之间的间距
            canvas.setRGBColorStroke(173, 216, 230);  // 设置线条颜色为灰色
            canvas.setLineWidth(0.9f);                // 设置线条宽度

            for (int i = 0; i < 10; i++) {             // 循环绘制 7 条横线
                float lineY = rectY + i * lineSpacing;

                // 偶数行填充浅蓝色
                if (i % 2 == 1) {
                    canvas.setRGBColorFill(120, 216, 250);  // 设置填充颜色为浅蓝色
                    canvas.rectangle(rectX, lineY - lineSpacing, rectWidth, lineSpacing); // 绘制填充矩形
                    canvas.fill();  // 渲染填充
                }

                // 绘制横线
                canvas.moveTo(rectX, lineY);          // 横线起始点
                canvas.lineTo(rectX + rectWidth, lineY); // 横线结束点
                canvas.stroke();                      // 渲染横线
            }

            x = 75;
            y= 432;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("项目");
            canvas.endText();

            x += 60;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("群体建模");
            canvas.endText();

            x += 80;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("心理测评");
            canvas.endText();

            x += 80;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("指标判定");
            canvas.endText();

            x += 80;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("个体建模");
            canvas.endText();

            x += 80;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont2, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("偏离指数");
            canvas.endText();
            EmotionParam emotionParam = emotionParamService.findIndicators().get(0);
            x = 75;
            y= 400;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("激动");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionParam.getAggressionBmin()) + "-" + String.valueOf(emotionParam.getAggressionBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionSubject.getAggressionM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getAggressionStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);

            canvas.showText(String.valueOf(emotionSubject.getAggressionBmin()) + "-" + String.valueOf(emotionSubject.getAggressionBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y= 368;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("压力");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionParam.getStressBmin()) + "-" + String.valueOf(emotionParam.getStressBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getStressM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getStressStatus()));
            canvas.endText();

            x +=65;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getStressBmin()) + "-" + String.valueOf(emotionSubject.getStressBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y= 338;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("焦虑");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionParam.getTensionBmin()) + "-" + String.valueOf(emotionParam.getTensionBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getTensionM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getTensionStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getTensionBmin()) + "-" + String.valueOf(emotionSubject.getTensionBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y= 308;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("疲劳");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionParam.getFatigueBmin()) + "-" + String.valueOf(emotionParam.getFatigueBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionSubject.getFatigue()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getFatigueStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getFatigueBmin()) + "-" + String.valueOf(emotionSubject.getFatigueBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y=278;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("自信");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionParam.getCharmBmin()) + "-" + String.valueOf(emotionParam.getCharmBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getCharmM()));
            canvas.endText();

            x +=87;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getCharmStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionSubject.getCharmBmin()) + "-" + String.valueOf(emotionSubject.getCharmBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y= 248;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("活力");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionParam.getEnergyBmin()) + "-" + String.valueOf(emotionParam.getEnergyBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionSubject.getEnergyM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getEnergyStatus()));
            canvas.endText();

            x +=65;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getEnergyBmin()) + "-" + String.valueOf(emotionSubject.getEnergyBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            x = 75;
            y=218;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("自控");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionParam.getRegulationBmin()) + "-" + String.valueOf(emotionParam.getRegulationBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getRegulationM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getRegulationStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText( String.valueOf(emotionSubject.getRegulationBmin()) + "-" + String.valueOf(emotionSubject.getRegulationBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();


            x = 75;
            y=188;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("压抑");
            canvas.endText();

            x += 58;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(  String.valueOf(emotionParam.getDepressionBmin()) + "-" + String.valueOf(emotionParam.getDepressionBmax()));
            canvas.endText();

            x += 95;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getDepressionM()));
            canvas.endText();

            x += 87;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(findStatus(emotionSubject.getDepressionStatus()));
            canvas.endText();

            x += 65;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText(String.valueOf(emotionSubject.getDepressionBmin()) + "-" + String.valueOf(emotionSubject.getDepressionBmax()));
            canvas.endText();

            x += 85;
            canvas.beginText();
            canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("-");
            canvas.endText();

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0); // 设置字体颜色为蓝色（0, 0, 200）
            canvas.setFontAndSize(baseFont2, 24);
            y = 150;
            x = 35;
            canvas.setTextMatrix(x, y);
            canvas.showText("回访记录");
            canvas.endText(); // 结束文本绘制

          rectX = 65;                // 矩形左上角的 X 坐标
           rectY = 65;               // 矩形左上角的 Y 坐标
            rectWidth = 450;           // 矩形宽度
            rectHeight = 60;          // 矩形高度

// 设置填充颜色为白色
            canvas.setRGBColorFill(255, 255, 255);  // 白色 (RGB: 255, 255, 255)

// 绘制并填充矩形
            canvas.rectangle(rectX, rectY, rectWidth, rectHeight); // 绘制矩形
            canvas.fill();  // 渲染填充

// 绘制边框
            canvas.setRGBColorStroke(0, 0, 0);  // 边框颜色为黑色
            canvas.setLineWidth(1);             // 边框线条宽度
            canvas.rectangle(rectX, rectY, rectWidth, rectHeight); // 再次绘制矩形
            canvas.stroke();                    // 渲染边框


            canvas.beginText();
            canvas.setFontAndSize(baseFont, 10);
            canvas.setTextMatrix(25, 20);
            canvas.showText("心 理 状 态 评 估 报 告");
            canvas.setTextMatrix(525, 20);
            canvas.showText("2");
            canvas.endText();


            // 创建新的一页
            document.newPage();

            // 加载新的背景图像
             newImagePath = "D:\\481\\AI_Emotion\\confg\\aa\\bj.png";
//             newImagePath = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/bj.png";
             newBackgroundImage = Image.getInstance(newImagePath);

            // 重新设置新背景图像的大小和位置
            newWidth = pageWidth * 1f;
            newHeight = (newWidth / newBackgroundImage.getWidth()) * newBackgroundImage.getHeight(); // 保持图像纵横比

            newBackgroundImage.scaleAbsolute(newWidth, newHeight); // 强制设置新的宽度和高度
            newBackgroundImage.setAbsolutePosition((pageWidth - newWidth) / 2, 0); // 将图像水平居中

            // 在新的一页上添加背景图像
            canvas.addImage(newBackgroundImage);
            // 在新的一页上继续添加报告内容
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 200);  // 蓝色的 RGB 值 (0, 0, 255)

            canvas.setFontAndSize(baseFont2, 24);
            x = 30;
            y = pageHeight - 80; // 重设 Y 坐标为新的页面顶部

            // 继续添加报告的内容，例如：
            canvas.setTextMatrix(x, y);
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 0)
            canvas.showText("三、心理指标说明");
            canvas.endText(); // 结束文本绘制

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 255)
            canvas.setFontAndSize(baseFont, 8);
//            y -= 30;
//            canvas.setTextMatrix(x, y);
//            canvas.setFontAndSize(baseFont2, 15);
//            canvas.showText("分级指数");
//
//            y -= 15;
//            canvas.setTextMatrix(x, y);
//            canvas.setFontAndSize(baseFont2, 9);
//            canvas.showText("一级：");
//
//
//            canvas.setFontAndSize(baseFont, 9);
//            x+=35;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("当事人的情绪活跃水平较高，可能会有明显增强的心境高涨，情绪不稳定，容易被激惹，或者明显提升的活动增多及精力旺盛，");
//
//            canvas.setFontAndSize(baseFont, 9);
//            x=30;y-=15;
//            canvas.setTextMatrix(x, y);
//            canvas.showText(" 严重者可能会情感爆发，甚至导致自伤或伤人等极端行为。");
//
//            y -= 15;x=30;
//            canvas.setTextMatrix(x, y);
//            canvas.setFontAndSize(baseFont2, 9);
//            canvas.showText("二级：");
//
//
//            canvas.setFontAndSize(baseFont, 9);
//            x+=35;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("当事人的情绪兴奋活跃水平偏低，可能会被他人观察到或者自己主观感受到精神倦怠、活动减少注意力不集中、犹豫不决等。");
//
//            y -= 15;x=30;
//            canvas.setTextMatrix(x, y);
//            canvas.setFontAndSize(baseFont2, 9);
//            canvas.showText("三级：");
//
//
//            canvas.setFontAndSize(baseFont, 9);
//            x+=35;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("当事人的情绪兴奋活跃水平正常，既不会过度否定或压抑自我，也不会过度向外界释放精力和能量，心身状态较为稳定。");
//            y -= 15;x=30;
//            canvas.setTextMatrix(x, y);
//            canvas.setFontAndSize(baseFont2, 9);
//            canvas.showText("四级：");
//            canvas.setFontAndSize(baseFont, 9);
//            x+=35;
//            canvas.setTextMatrix(x, y);
//            canvas.showText("当事人的情绪兴奋活跃水平正常，既不会过度否定或压抑自我，也不会过度向外界释放精力和能量，心身状态较为稳定。");

            x=30; y=730;
            canvas.setFontAndSize(baseFont2, 18);
            canvas.setTextMatrix(x, y);
            canvas.showText("[压力指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("压力指数是表征压力源对个体身心状态稳定性所施加的影响强度。这种影响可能与个体内外环境条件");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("与其自身应对能力的失衡有关，可能出现一系列心理生理反应，例如心率加快、血压升高、呼吸急促、");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("激素分泌增加等。压力指数过高时，个体的身心状态面临失衡或崩溃的风险，可能产生对压力源的持");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("续回避、负面情绪状态的显著增加，以及社会适应能力的显著下降。 另一方面，如果指数过低，可能");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("会表现为缺乏动力。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       低:当前压力源对个体没有产生明确的影响，如果指数过低，可能会表现为缺乏动力。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:压力源目前对当事人的影响适度，既不会对心身状态构成超载的负面影响，也能够促使当事人保持一定强度的动机和");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       自我效能，从而使其社会功能得以良好发挥。");

            x=30; y=560;
            canvas.setFontAndSize(baseFont2, 18);
            canvas.setTextMatrix(x, y);
            canvas.showText("[焦虑指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("焦虑指数是表征个体对于危及生命安全、前途命运等重大问题,以及难以预测、难以应对的事件的关注");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("程度;其中可能含有着急、挂念、忧愁、不安、烦躁等多种情绪成分。焦虑指数较高，常有强烈的主观");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("痛苦感，或严重的社会功能受损，可能伴有明显的自主神经系统功能紊乱和运动性不安。当焦虑情绪强");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("度超出了现实威胁的实际水平,或者持续时间过长时就会变成病理性焦虑。");
//
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       和运动性不安。当焦虑情绪强度超出了现实威胁的实际水平,或者持续时间过长时就会变成病理性焦虑。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       低:当事人目前焦虑指数低，不存在较大的现实困难和挑战，或者坚信自己有解决所有问题的能力可能对周遭存在的风险");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       缺乏足够的警惕，也常常忽视生活和工作中的细节。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:当事人的焦虑感受适度，较少感觉到焦急、烦躁的情绪，或者对未来事件怀有不确定的担心及忧虑。这可能是由于");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       当事人对于生活中的各种挫折和困难，能够以比较平和的心态去面对，善于用适当的方式去化解。");

            x=30; y=405;
            canvas.setFontAndSize(baseFont2, 18);
            canvas.setTextMatrix(x, y);
            canvas.showText("[稳定指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("稳定指数是表征个体改变自己的心身状态以适应环境要求的能力。个体通过自我调节能力，内省和控制");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("自身的情绪状态，同时洞悉他人的情绪状态; 在此基础上，评估自己行为的正确性和客观程度，使得自");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("己的行为尽可能达到预期效果。稳定指数较低，对自身情绪的管理和控制能力可能较为薄弱，稳定性低");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("可能会因为压力大、焦虑程度高导致自身情绪不稳定，也可能因为长期处于疲劳和压抑状态导致缺失足");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("够的能量来掌控自身情绪状态。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       可能因为长期处于疲劳和压抑状态导致缺失足够的能量来掌控自身情绪状态。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:当事人比较善于与人融治相处，没有过多的对抗性情绪和行为。当被他人的观念、行为或事件所袭扰时，当事人能够");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       以较为平和、理智的心态去应对，可以比较客观地理解他人的想法和行为，并且比较友善地处理与他人的关系。");

            x=30; y=260;
            canvas.setFontAndSize(baseFont2, 18);
            canvas.setTextMatrix(x, y);
            canvas.showText("[压抑指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("抑制指数是表征个体心身状态被外界或内心力量所压抑和限制的程度。个体的心身能量需要维持在相对");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("稳定的范围内，遭受过度压制，或者缺乏必要的限制手段，都可能产生诸多情绪及身体状态方面的异常");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("问题。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       高:当事人当前平衡指数高，可能秉持锐意进取的处事原则，性格偏于强势，有强大的支配掌控欲望和手段，能够驾驭不及");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       自己的人，也会主动反抗比自己更强大的人。分数过高则可能刚自用，不容易听从他人的意见。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       低:当事人当前平衡指数较低，可能经常自我怀疑，做决定时瞻前顾后、犹豫不决，总是害怕做错事。说错话，遇事时首先");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       考虑迎合别人的意志、附和别人的意见，而不敢表达自己的意见，自我评价较低总是在意他人对自己的评价和看法。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:当事人能够接纳并喜欢自己，与自己的缺点和谐共处。遇事有主见，也乐于展示自己的想法和信念。对于外界针对自");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       己的看法和评价，能够以客观的心态审视抉择;对有损自己核心利益的行为，能够主动拒绝和抵制。");

            canvas.endText(); // 结束文本绘制

            canvas.beginText();
            canvas.setFontAndSize(baseFont, 10);
            canvas.setRGBColorFill(255, 255, 255);  // 白色 (RGB: 255, 255, 255)
            canvas.setTextMatrix(25, 20);
            canvas.showText("心 理 状 态 评 估 报 告");
            canvas.setTextMatrix(525, 20);
            canvas.showText("3");
            canvas.endText();


            // 创建新的一页
            document.newPage();

            // 加载新的背景图像
            newImagePath = "D:\\481\\AI_Emotion\\confg\\aa\\bj.png";
//            newImagePath = "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/bj.png";
            newBackgroundImage = Image.getInstance(newImagePath);

            // 重新设置新背景图像的大小和位置
            newWidth = pageWidth * 1f;
            newHeight = (newWidth / newBackgroundImage.getWidth()) * newBackgroundImage.getHeight(); // 保持图像纵横比

            newBackgroundImage.scaleAbsolute(newWidth, newHeight); // 强制设置新的宽度和高度
            newBackgroundImage.setAbsolutePosition((pageWidth - newWidth) / 2, 0); // 将图像水平居中

            // 在新的一页上添加背景图像
            canvas.addImage(newBackgroundImage);
            // 在新的一页上继续添加报告内容
            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 200);  // 蓝色的 RGB 值 (0, 0, 255)

            canvas.setFontAndSize(baseFont2, 24);
            x = 30;
            y = pageHeight - 80; // 重设 Y 坐标为新的页面顶部

            // 继续添加报告的内容，例如：
            canvas.setTextMatrix(x, y);
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 0)
            canvas.showText("三、心理指标说明");
            canvas.endText(); // 结束文本绘制

            canvas.beginText();
            canvas.setRGBColorFill(0, 0, 0);  // 蓝色的 RGB 值 (0, 0, 255)
            canvas.setFontAndSize(baseFont, 8);
            y -= 30;
            canvas.setTextMatrix(x, y);
            canvas.setFontAndSize(baseFont2, 15);
            canvas.showText("[平衡指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("平衡指数表征个体对自身能力的信任和确定程度。是一种积极、有效地表达自我价值、自我尊重、自");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("我理解的意识特征和心理状态。平衡指数影响着学习、竞赛、就业、成就等多方面的个体心理和行为。");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("平衡指数较低，可能经常自我怀疑，做决定时瞻前顾后、犹豫不决，总是害怕做错事说错话，遇事时首");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("先考虑迎合别人的意志、附和别人的意见，而不敢表达自己的意见，自我评价较低，总是在意他人对自");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("己的评价和看法。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       低:当事人当前平衡指数较低，可能经常自我怀疑，做决定时瞻前顾后、犹豫不决，总是害怕做错事说错话，遇事时首先考");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       虑迎合别人的意志、附和别人的意见，而不敢表达自己的意见，自我评价较低，总是在意他人对自己的评价和看法。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:当事人能够接纳并喜欢自己，与自己的缺点和谐共处。遇事有主见，也乐于展示自己的想法和信念。对于外界针对自");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       己的看法和评价，能够以客观的心态审视抉择;对有损自己核心利益的行为，能够主动拒绝和抵制。");

            y -= 65;
            canvas.setTextMatrix(x, y);
            canvas.setFontAndSize(baseFont2, 15);
            canvas.showText("[能量指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("指人的身体能量或活力状态。能量指数低会觉得身体累、活力不足，可能出现生理上的疲惫和大脑认");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("知效率的降低，这可能因疾病、饮食、睡眠不足引起，也可能因被测试人员所处的环境或某些事件引");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("起。能量指数高表明当前身体活力度较高,可能精力旺盛,做事积极有动力,大脑很活跃,感觉自己能同");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("时完成很多事情,但长时间高强度进行身体和心理活动容易导致能量的过度消耗，不利于身心健康。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       体和心理活动容易导致能量的过度消耗，不利于身心健康。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       低:当前身体活力度低，可能出现生理上的疲惫和大脑认知效率的降低，导致思考能力和注意力降低，感到无聊无趣、做事缺");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       乏动力，可能学习和工作效率也明显降低。");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       正常:当前身体活力度正常，做事有一定积极性。对于正在进行的任务能够保持适当的动机和注意力，可能更容易实现预定目");
//            y-=15;
//            canvas.setFontAndSize(baseFont, 9);
//            canvas.setTextMatrix(x, y);
//            canvas.showText("       标和感受到内心的愉悦与幸福。");

            y -= 65;
            canvas.setTextMatrix(x, y);
            canvas.setFontAndSize(baseFont2, 15);
            canvas.showText("[紧张指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("紧张指数表征个体的情绪兴奋活跃程度，指数过高可能表现为情绪亢奋、躁动、易激惹，或者有明显");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("的活动增多及精力旺盛，严重 者可能会产生情感爆发，甚至导致自伤或者伤人等偏极端行为。");

            y -= 65;
            canvas.setTextMatrix(x, y);
            canvas.setFontAndSize(baseFont2, 15);
            canvas.showText("[疲劳指数]");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("长期慢性压力会产生睡眠不足、睡眠质量差等问题，导致疲劳度高。若长期处于疲劳状态，会有更大");
            y-=20;
            canvas.setFontAndSize(baseFont, 12);
            canvas.setTextMatrix(x, y);
            canvas.showText("的可能性引发抑郁和焦虑。");

            canvas.setFontAndSize(baseFont, 10);
            canvas.setRGBColorFill(255, 255, 255);  // 白色 (RGB: 255, 255, 255)
            canvas.setTextMatrix(25, 20);
            canvas.showText("心 理 状 态 评 估 报 告");
            canvas.setTextMatrix(525, 20);
            canvas.showText("4");
            canvas.endText();



            // 关闭文档
            document.close();
            System.out.println("PDF 文件已生成！");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    public static void biaoge(PdfContentByte canvas, float x, float y, float width, float height,BaseFont baseFont,BaseFont baseFont2,String no,String name) {


        // 表格宽度和高度
        float leftTableWidth = 450 / 2;  // 左边表格占一半
        float rightTableWidth = 450 / 2; // 右边表格占一半

        // 左右表格的高度
        float tableHeightLeft = 100;
        float tableHeightRight = 100;

        // 绘制大表格（分成左右两格）
        canvas.setRGBColorStroke(169, 169, 169); // 设置灰色
        canvas.setLineWidth(1);

        // 左边表格
        canvas.moveTo(x, y);
        canvas.lineTo(x + 475, y); // 顶边
        canvas.lineTo(x + 475, y - tableHeightLeft); // 右边
        canvas.lineTo(x, y - tableHeightLeft); // 底边
        canvas.closePathStroke();

        // 右边表格
        canvas.moveTo(x + leftTableWidth, y);
        canvas.lineTo(x + 475, y); // 顶边
        canvas.lineTo(x + 475, y - tableHeightRight); // 右边
        canvas.lineTo(x + leftTableWidth, y - tableHeightRight); // 底边
        canvas.closePathStroke();

        // 绘制左边表格的细分区域：分成三行四列，第一行合并
        float rowHeight = tableHeightLeft / 3;
        float colWidth = leftTableWidth / 4;

        // 绘制左边的纵向分隔线（列的分隔线）
        for (int i = 1; i < 4; i++) {
            // 绘制列的分隔线
            canvas.moveTo(x + i * colWidth, y - tableHeightLeft / 3);
            canvas.lineTo(x + i * colWidth, y - 3 * tableHeightLeft / 3);
        }

        // 绘制第二行和第三行的横向分隔线（去掉第一行的横向分隔线）
        for (int i = 1; i <= 2; i++) {
            // 绘制左边的横向分隔线
            canvas.moveTo(x, y - (i * rowHeight));
            canvas.lineTo(x + leftTableWidth, y - (i * rowHeight));
        }
        canvas.closePathStroke();

        // 绘制左边表格的标题栏，蓝色背景，白色字体
        canvas.setRGBColorFill(0, 100, 200); // 蓝色背景
        canvas.rectangle(x - 30, y - 100, 30, 100); // 绘制标题栏
        canvas.fill();

        // 设置白色字体
        canvas.beginText();
        canvas.setRGBColorFill(255, 255, 255); // 设置字体颜色为蓝色（0, 0, 200）
        canvas.setFontAndSize(baseFont2, 24);
        y -= 55;
        x -= 22;
        canvas.setTextMatrix(x, y);
        canvas.showText(no);
        canvas.endText(); // 结束文本绘制

        x += 265;
        y -= 32;
        width = 230;
        height = 85;
        drawLineChartWithGrid(canvas, x, y, width, height);


        canvas.beginText();
        canvas.setFontAndSize(baseFont2, 16);
        canvas.setRGBColorFill(0, 0, 0);
        y += 65;
        x -= 237;
        canvas.setTextMatrix(x, y);
        canvas.showText(name);
        x += 160;
        canvas.setTextMatrix(x, y);
        canvas.showText("75.54");
        x -= 155;
        y -= 33;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("最小值");

        x += 55;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("平均值");

        y -= 30;
        x -= 55;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("23.12");

        x += 58;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("23.12");

        x += 54;
        y += 30;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("最大值");

        x += 4;
        y -= 30;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("76.74");

        x += 46;
        y += 30;
        canvas.setFontAndSize(baseFont, 12);
        canvas.setTextMatrix(x, y);
        canvas.showText("参考范围");

        x -= 2;
        y -= 30;
        canvas.setFontAndSize(baseFont, 10);
        canvas.setTextMatrix(x, y);
        canvas.showText("34.32-78.11");
        canvas.endText();
    }
    public static void drawLineChartWithGrid(PdfContentByte canvas, float x, float y, float width, float height) {
        // 横坐标和纵坐标的设置
        int xTicks = 11; // 横坐标 0 到 100，每 10 为一刻度，总共 11 个刻度
        int yTicks = 6;  // 纵坐标从 0 到 10，每 2 为一刻度，总共 6 个刻度

        // 设置灰色的线条颜色（用于刻度）
        canvas.setRGBColorStroke(169, 169, 169); // 灰色
        canvas.setLineWidth(1);

        // 绘制横向网格线（每 10 的位置）
        for (int i = 0; i < xTicks; i++) {
            float xPos = x + (i * width / (xTicks - 1)); // 每个刻度的横坐标
            canvas.moveTo(xPos, y);
            canvas.lineTo(xPos, y + height);
            canvas.stroke();
        }

        // 绘制纵向网格线（每 2 的位置）
        for (int i = 0; i < yTicks; i++) {
            float yPos = y + (i * height / (yTicks - 1)); // 每个刻度的纵坐标
            canvas.moveTo(x, yPos);
            canvas.lineTo(x + width, yPos);
            canvas.stroke();
        }

        // 添加横纵坐标刻度标签
        canvas.beginText();
        try {
            canvas.setFontAndSize(BaseFont.createFont(BaseFont.HELVETICA, BaseFont.CP1252, BaseFont.EMBEDDED), 6);
        } catch (Exception e) {
            e.printStackTrace();
        }
        canvas.setRGBColorFill(0, 0, 0); // 黑色字体

        // 横坐标刻度标签
        for (int i = 0; i < xTicks; i++) {
            float xPos = x + (i * width / (xTicks - 1));
            String label = String.valueOf(i * 10); // 横坐标每隔 10 增加
            canvas.setTextMatrix(xPos - 5, y - 10);
            canvas.showText(label);
        }

        // 纵坐标刻度标签
        for (int i = 0; i < yTicks; i++) {
            float yPos = y + (i * height / (yTicks - 1));
            String label = String.valueOf(i * 2); // 纵坐标每隔 2 增加
            canvas.setTextMatrix(x - 12, yPos - 5);
            canvas.showText(label);
        }
        canvas.endText();

        // 设置折线图的颜色为蓝色
        canvas.setRGBColorStroke(0, 0, 255); // 蓝色线条
        canvas.setLineWidth(2); // 设置线条宽度

        // 假设的数据点
        List<Float> data = new ArrayList<>();
        data.add(1f);
        data.add(3f);
        data.add(5f);
        data.add(7f);
        data.add(6f);
        data.add(9f);
        data.add(10f);
        data.add(8f);
        data.add(6f);
        data.add(4f);
        data.add(2f);

        // 计算数据点的位置并绘制折线
        float prevX = x;
        float prevY = y + (data.get(0) * height / 10); // 第一个数据点纵坐标

        for (int i = 1; i < data.size(); i++) {
            float xPos = x + ((i) * width / (xTicks - 1)); // 计算当前点的横坐标
            float yPos = y + (data.get(i) * height / 10); // 计算当前点的纵坐标

            // 绘制折线连接前一个数据点和当前数据点
            canvas.moveTo(prevX, prevY);
            canvas.lineTo(xPos, yPos);
            canvas.stroke();

            // 绘制数据点（圆点）
            canvas.setRGBColorFill(0, 0, 255); // 设置蓝色填充
            canvas.circle(xPos, yPos, 3); // 半径为 3 的圆点
            canvas.fillStroke();

            prevX = xPos;
            prevY = yPos;
        }
    }

    /**
     * @param clazz java.lang.Class<?>:
     * @Description: 获取相对路径
     * @return: java.lang.String
     * @Author: ztf
     * @Update:
     * @Date: 2024/5/16 11:04
     */
    public static String obtainAbsolutePath(Class<?> clazz) {
        // 获取加载实体类的类加载器
        ClassLoader classLoader = clazz.getClassLoader();

        // 获取实体类所在的包路径
        String packagePath = clazz.getPackage().getName().replace(".", "/");

        // 获取实体类的路径
        String classPath = classLoader.getResource(packagePath + "/" + clazz.getSimpleName() + ".class").getPath();

        int firstIndex = classPath.indexOf("/");
        System.out.println(firstIndex);
        int lastIndex = classPath.lastIndexOf("/");
        String result2 = classPath.substring(firstIndex + 1, lastIndex);
//        result2= result2.substring(0, result2.indexOf("target"));
        String result = "/"+result2;
        return result;
    }




    public static String findStatus(Long status) {
        String result = null;
        if (status == 0) {
            result = "低";
        }
        if (status == 1) {
            result = "中";
        }
        if (status == 2) {
            result = "高";
        }
        return result;
    }


    public static String findPsyStatus(Long status) {
        String result = null;
        if (status == 0) {
            result = "正常";
        }
        if (status == 1) {
            result = "一般";
        }
        if (status == 2) {
            result = "关注";
        }
        return result;
    }

    public static String findAlarmStatus(Long status) {
        String result = null;
        if (status == 0) {
            result = "/";
        }
        if (status == 1) {
            result = "低";
        }
        if (status == 2) {
            result = "中";
        }
        if (status == 2) {
            result = "高";
        }
        return result;
    }

    public static String findAnnotation(Long status) {
        String result = null;
        if (status == 0) {
            result = "/";
        }
        if (status == 1) {
            result = "低";
        }
        if (status == 2) {
            result = "中";
        }
        if (status == 2) {
            result = "高";
        }
        return result;
    }
    public static void drawPercentileChart(PdfContentByte canvas, float x, float y, float barWidth, float barHeight, String title, int position, BaseColor deepBlue, BaseFont baseFont, Double min, Double max, Double average, Double real) {
        float segmentWidth = barWidth / 100.0f; // 每单位的宽度，假设 0-100 的范围

        // 判断 real 和 average 的大小，调整填充颜色区域
        if (real < average) {
            // 深蓝色填充 real 区域
            canvas.setColorFill(deepBlue);
            canvas.rectangle(x, y, segmentWidth * real, barHeight);
            canvas.fill();

            // 浅蓝色填充 real 到 average 区域
            canvas.setRGBColorFill(173, 216, 230); // 浅蓝色
            canvas.rectangle(x + segmentWidth * real, y, segmentWidth * (average - real), barHeight);
            canvas.fill();
            // 灰色填充 average 到 100 区域
            canvas.setRGBColorFill(211, 211, 211); // 灰色
            canvas.rectangle(x + segmentWidth * average, y, segmentWidth * (100 - average), barHeight);
            canvas.fill();
        } else {
            // 浅蓝色填充 average 区域
            canvas.setRGBColorFill(173, 216, 230); // 浅蓝色
            canvas.rectangle(x, y, segmentWidth * average, barHeight);
            canvas.fill();

            // 深蓝色填充 average 到 real 区域
            canvas.setColorFill(deepBlue);
            canvas.rectangle(x + segmentWidth * average, y, segmentWidth * (real - average), barHeight);
            canvas.fill();

            // 灰色填充 real 到 100 区域
            canvas.setRGBColorFill(211, 211, 211); // 灰色
            canvas.rectangle(x + segmentWidth * real, y, segmentWidth * (100 - real), barHeight);
            canvas.fill();
        }

        // 绘制橙色指示器（三角形）
        drawTriangleAndLabel(canvas, x, y, barHeight, segmentWidth, real, baseFont);


        // 添加标题
        canvas.beginText();
        canvas.setRGBColorFill(0, 0, 0);
        canvas.setFontAndSize(baseFont, 12);
        canvas.showTextAligned(Element.ALIGN_CENTER, title, x+5 , y + barHeight +5, 0);
        canvas.endText();

        // 添加刻度
        addScale(canvas, x, y, barWidth, barHeight, baseFont);
    }


    private static void drawTriangleAndLabel(PdfContentByte canvas, float x, float y, float barHeight, float segmentWidth, Double real, BaseFont baseFont) {
        // 倒三角形绘制
        float real1 = real.floatValue();
        canvas.setColorFill(BaseColor.ORANGE);
        float triangleX = x + real1 * segmentWidth; // real 的位置
        float triangleY = y + barHeight;
        canvas.moveTo(triangleX, triangleY); // 顶点
        canvas.lineTo(triangleX - 7, triangleY + 7); // 左上
        canvas.lineTo(triangleX + 7, triangleY + 7); // 右上
        canvas.closePathFillStroke();

        // 在倒三角右侧显示 real 的值
        canvas.beginText();
        canvas.setFontAndSize(baseFont, 10);
        canvas.setRGBColorFill(0, 0, 0); // 黑色文本
        canvas.showTextAligned(Element.ALIGN_LEFT, String.valueOf(real), triangleX + 8, triangleY + 3, 0); // 在右侧稍上方显示 real
        canvas.endText();
    }

    // 修改后的 addScale 方法，仅显示 0 和 100
    public static void addScale(PdfContentByte canvas, float x, float y, float barWidth, float barHeight, BaseFont baseFont) {
        // 刻度线宽度
        float lineWidth = 0.5f;

        // 左侧 0 刻度
        canvas.setRGBColorStroke(0, 0, 0); // 黑色刻度线
        canvas.setLineWidth(lineWidth);
        canvas.moveTo(x, y - 5); // 刻度线起点
        canvas.lineTo(x, y);    // 刻度线终点
        canvas.stroke();

        canvas.beginText();
        canvas.setFontAndSize(baseFont, 10);
        canvas.setRGBColorFill(0, 0, 0);
        canvas.showTextAligned(Element.ALIGN_CENTER, "0", x, y - 13, 0); // 显示 0
        canvas.endText();

        // 右侧 100 刻度
        canvas.moveTo(x + barWidth, y - 5);
        canvas.lineTo(x + barWidth, y);
        canvas.stroke();

        canvas.beginText();
        canvas.setFontAndSize(baseFont, 10);
        canvas.setRGBColorFill(0, 0, 0);
        canvas.showTextAligned(Element.ALIGN_CENTER, "100", x + barWidth, y - 13, 0); // 显示 100
        canvas.endText();
    }

    private static int count = 8; // 多边形边数
    private static int layerCount = 4; // 层数

    private static String[] titles = {"激动", "压力", "焦虑", "疲劳", "自信", "活力", "自控", "压抑"};// 文字}

    /**
     * @Description: 生成雷达图的图像，整个过程就是将情感主题的数据绘制成雷达图，并将其转换为可用于文档或其他用途的图像。
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:54
     **/
    public static Image generateRadarImage(int width, int height, EmotionSubject emotionSubject) {
        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = image.createGraphics();
        g2d.setBackground(new Color(0, 0, 0, 0)); // 设置背景为透明
        g2d.clearRect(0, 0, width, height); // 清空背景
        // 加载字体
        String classPath = obtainAbsolutePath(PdfExporter.class);
        // 输出实体类的路径
        String fontPath =  "/home/kylin/PsychologyHealthy11.13/PsychologyHealthy10.10/PsychologyHealthy10.10/modules/psychology_healthy/src/main/java/com/jeesite/modules/subject/web/style/Song.ttf";
        java.awt.Font font = null;
        try {
            // 加载字体并设置字体大小为您希望的大小，例如 12
            font = java.awt.Font.createFont(java.awt.Font.TRUETYPE_FONT, new File(fontPath)).deriveFont(20f);
        } catch (FontFormatException | IOException e) {
            e.printStackTrace();
        }
        g2d.setFont(font);
        // 设置字体颜色为黑色
        g2d.setColor(Color.BLACK);
        drawRadar(g2d, width, height, emotionSubject);
        g2d.dispose();

        // 将 BufferedImage 转换为 iText 中的 Image 对象
        Image iTextImage = null;
        try {
            ByteArrayOutputStream baos = new ByteArrayOutputStream();
            ImageIO.write(image, "png", baos);
            iTextImage = Image.getInstance(baos.toByteArray());
        } catch (IOException e) {
            e.printStackTrace();
        } catch (BadElementException e) {
            throw new RuntimeException(e);
        }
        return iTextImage;
    }

    /**
     * @Description: 绘制雷达图
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:53
     **/
    private static void drawRadar(Graphics2D g2d, int width, int height, EmotionSubject emotionSubject) {
        float radius = Math.min(width, height) / 2 * 0.7f;
        int centerX = width / 2;
        int centerY = height / 2;

        drawPolygon(g2d, radius, centerX, centerY);
        drawLines(g2d, radius, centerX, centerY);
        drawText(g2d, radius, centerX, centerY);
        drawCoveredArea(g2d, radius, centerX, centerY, emotionSubject);
    }

    /**
     * @Description: 绘制多边形和层
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:52
     **/
    private static void drawPolygon(Graphics2D g2d, float radius, int centerX, int centerY) {
        // 绘制多边形边框
        for (int i = 1; i <= layerCount; i++) {
            float curR = radius / layerCount * i; // 当前层的半径
            Path2D.Float path = new Path2D.Float();
            for (int j = 0; j < count; j++) {
                if (j == 0) {
                    path.moveTo(centerX, centerY - curR);
                } else {
                    float x = (float) (centerX + Math.sin(Math.PI * 2 / count * j) * curR);
                    float y = (float) (centerY - Math.cos(Math.PI * 2 / count * j) * curR);
                    path.lineTo(x, y);
                }
            }
            path.closePath();
            g2d.draw(path);
        }
    }

    /**
     * @Description: 雷达图连线
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:51
     **/
    private static void drawLines(Graphics2D g2d, float radius, int centerX, int centerY) {
        // 绘制连接线
        for (int i = 0; i < count; i++) {
            float startX = (float) (centerX + Math.sin(Math.PI * 2 / count * i) * (radius / layerCount));
            float startY = (float) (centerY - Math.cos(Math.PI * 2 / count * i) * (radius / layerCount));
            float endX = (float) (centerX + Math.sin(Math.PI * 2 / count * i) * radius);
            float endY = (float) (centerY - Math.cos(Math.PI * 2 / count * i) * radius);
            g2d.drawLine((int) startX, (int) startY, (int) endX, (int) endY);
        }
    }

    /**
     * @Description: 文字设置
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:51
     **/
    private static void drawText(Graphics2D g2d, float radius, int centerX, int centerY) {
        // 获取字体的信息
        FontMetrics fm = g2d.getFontMetrics();
        // 遍历每个顶点对应的标题
        for (int i = 0; i < count; i++) {
            // 计算当前顶点的坐标
            float x = (float) (centerX + Math.sin(Math.PI * 2 / count * i) * (radius + 15)); // 调整文字距离中心的距离
            float y = (float) (centerY - Math.cos(Math.PI * 2 / count * i) * (radius + 15)); // 调整文字距离中心的距离
            String title = titles[i]; // 获取当前顶点对应的标题
            int titleWidth = fm.stringWidth(title); // 获取标题的宽度
            int titleHeight = fm.getHeight(); // 获取标题的高度
            // 根据顶点在雷达图上的位置进行文字绘制
            if (Math.PI * 2 / count * i == 0) {
                g2d.drawString(title, (int) x - titleWidth / 2 + 5, (int) y - 18);
            } else if (Math.PI * 2 / count * i > 0 && Math.PI * 2 / count * i < Math.PI / 2 && i != 2 && i != 3) {
                g2d.drawString(title, (int) x + 18, (int) y + 10);
            } else if (Math.PI * 2 / count * i >= Math.PI / 2 && Math.PI * 2 / count * i < Math.PI && i != 2 && i != 3) {
                g2d.drawString(title, (int) x - titleWidth, (int) y + titleHeight + 18);
            } else if (Math.PI * 2 / count * i >= Math.PI && Math.PI * 2 / count * i < 3 * Math.PI / 2) {
                if (i == count - 1) { // 最右边的文字
                    g2d.drawString(title, (int) x - titleWidth, (int) y + titleHeight / 2 + 15); // 调整文字位置
                } else {
                    g2d.drawString(title, (int) x - titleWidth, (int) y + titleHeight + 18);
                }
            } else if (Math.PI * 2 / count * i >= 3 * Math.PI / 2 && Math.PI * 2 / count * i < 2 * Math.PI) {
                g2d.drawString(title, (int) x - titleWidth - 18, (int) y + 10);
            }
            if (i == 2) {
                g2d.drawString(title, (int) x + 18, (int) y + 5);
            } else if (i == 3) {
                g2d.drawString(title, (int) x + 18, (int) y + 8);
            }
        }
    }

    /**
     * @Description: 覆盖区域
     * @return:
     * @Author: 鄢文杰
     * @Date: 2024/5/31 21:51
     **/
    private static void drawCoveredArea(Graphics2D g2d, float radius, int centerX, int centerY, EmotionSubject emotionSubject) {
        double[] psyPercents = {
                emotionSubject.getAggressionM() / 100.0,
                emotionSubject.getStressM() / 100.0,
                emotionSubject.getTensionM() / 100.0,
                emotionSubject.getFatigue() / 100.0,
                emotionSubject.getCharmM() / 100.0,
                emotionSubject.getEnergyM() / 100.0,
                emotionSubject.getRegulationM() / 100.0,
                emotionSubject.getDepressionM() / 100.0
        };

//        double[] individualPercentsMin = {
//                emotionSubject.getAggressionBmin() / 100.0,
//                emotionSubject.getStressBmin() / 100.0,
//                emotionSubject.getTensionBmin() / 100.0,
//                emotionSubject.getFatigueBmin() / 100.0,
//                emotionSubject.getCharmBmin() / 100.0,
//                emotionSubject.getEnergyBmin() / 100.0,
//                emotionSubject.getRegulationBmin() / 100.0,
//                emotionSubject.getDepressionBmin() / 100.0
//        };
//
//        double[] individualPercentsMax = {
//                emotionSubject.getAggressionBmax() / 100.0,
//                emotionSubject.getStressBmax() / 100.0,
//                emotionSubject.getTensionBmax() / 100.0,
//                emotionSubject.getFatigueBmax() / 100.0,
//                emotionSubject.getCharmBmax() / 100.0,
//                emotionSubject.getEnergyBmax() / 100.0,
//                emotionSubject.getRegulationBmax() / 100.0,
//                emotionSubject.getDepressionBmax() / 100.0
//        };

        Color[] colors = {
                new Color(0, 0, 255, 100),     // 蓝色
                new Color(0, 255, 0, 100),     // 绿色
                new Color(255, 0, 0, 100)      // 红色
        };

        double[][] percentsArrays = {psyPercents};

        for (int i = 0; i < percentsArrays.length; i++) {
            Path2D.Float path = new Path2D.Float();
            for (int j = 0; j < count; j++) {
                if (j == 0) {
                    path.moveTo(centerX, centerY - radius * percentsArrays[i][j]);
                } else {
                    float x = (float) (centerX + Math.sin(Math.PI * 2 / count * j) * (radius * percentsArrays[i][j]));
                    float y = (float) (centerY - Math.cos(Math.PI * 2 / count * j) * (radius * percentsArrays[i][j]));
                    path.lineTo(x, y);
                }
            }
            path.closePath();

            g2d.setColor(colors[i]);
            g2d.fill(path);
        }
    }

    @RequestMapping(value = "fenweitu")
    @ResponseBody
    private static String fenweitu(String min, String max, String result) throws IOException {
        double doubleMin = Double.parseDouble(min);
        double doubleMax = Double.parseDouble(max);
        double doubleResult = Double.parseDouble(result);

        // 创建 BufferedImage
        BufferedImage bufferedImage = new BufferedImage(120, 40, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = bufferedImage.createGraphics();

        // 设置抗锯齿
        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

        // 设置矩形颜色
        Color lowColor = new Color(255, 0, 0);  // 低分段颜色（黄色）
        Color midColor = new Color(0, 255, 0);  // 中分段颜色（橙色）
        Color highColor = new Color(255, 0, 0);    // 高分段颜色（红色）

        // 绘制低、中、高三个矩形段
        int rectY = 10; // 矩形的Y坐标
        int rectHeight = 20;  // 矩形的高度
        int rectWidth = (int) doubleMin; // 低分段宽度
        int rectWidth2 = (int) doubleMax - (int) doubleMin; // 中分段宽度
        int rectWidth3 = 100 - (int) doubleMax; // 高分段宽度

        // 低分段
        g2d.setColor(lowColor);
        g2d.fillRect(10, rectY, rectWidth, rectHeight);

        // 中分段
        g2d.setColor(midColor);
        g2d.fillRect(10 + rectWidth, rectY, rectWidth2, rectHeight);

        // 高分段
        g2d.setColor(highColor);
        g2d.fillRect(10 + rectWidth + rectWidth2, rectY, rectWidth3, rectHeight);

        // 设置字体
        java.awt.Font font = new java.awt.Font("Song", java.awt.Font.PLAIN, 19);
        g2d.setFont(font);
        g2d.setColor(Color.BLACK); // 设置文本颜色为黑色

        // 设置倒三角的下方顶点坐标
        int bottomVertexX = (int) doubleResult+10; // 下方顶点X坐标
        int bottomVertexY = rectY; // 下方顶点Y坐标

        // 计算上方两个顶点坐标
        int[] xPoints = {bottomVertexX - 7, bottomVertexX, bottomVertexX + 7}; // 上方两个顶点X坐标
        int[] yPoints = {bottomVertexY - 7, bottomVertexY, bottomVertexY - 7}; // 上方两个顶点Y坐标

        Color tri = new Color(57, 205, 220);
        g2d.setColor(tri); // 黑色填充三角形
        g2d.fillPolygon(xPoints, yPoints, 3);

        // 释放资源
        g2d.dispose();

        // 将 BufferedImage 转换为字节数组
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        ImageIO.write(bufferedImage, "png", baos);
        byte[] imageBytes = baos.toByteArray();

        // 使用 Base64 编码字节数组
        String base64Image = Base64.getEncoder().encodeToString(imageBytes);

        // 返回 Base64 编码的图像数据
        return base64Image;
    }
}
